<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Server Side Rendering ‚Äì Intermediate React v6</title><meta name="description" content="Discover how to enhance your React app&#x27;s performance with server-side rendering (SSR) as demonstrated by Brian Holt in the Intermediate React v6 course for Frontend Masters. Learn how to implement SSR by hand to optimize time to interactive and first meaningful paint, along with considerations for complexity and device performance. Explore practical examples of SSR app setup with Fastify, Vite, and React, including handling browser-only scripts and overcoming hydration errors." data-next-head=""/><meta name="keywords" content="React,server-side rendering,SSR,Brian Holt,Frontend Masters" data-next-head=""/><meta name="og:description" content="Discover how to enhance your React app&#x27;s performance with server-side rendering (SSR) as demonstrated by Brian Holt in the Intermediate React v6 course for Frontend Masters. Learn how to implement SSR by hand to optimize time to interactive and first meaningful paint, along with considerations for complexity and device performance. Explore practical examples of SSR app setup with Fastify, Vite, and React, including handling browser-only scripts and overcoming hydration errors." data-next-head=""/><meta name="og:title" content="Server Side Rendering ‚Äì Intermediate React v6" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/0732dfa8741dc542.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0732dfa8741dc542.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-a4ddb9b21624b39b.js" defer=""></script><script src="/_next/static/chunks/main-d4c20200ddabac7f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-31cd0638bbee6098.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-7da2347a1e0b6c73.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_buildManifest.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Intermediate React v6</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/courses/intermediate-react-v6/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><blockquote>
<p>üí° The previous version of this course does a pretty in-depth dive on migrating a client-side React app to being server-side render. <a href="https://frontendmasters.com/courses/intermediate-react-v5/server-side-rendering/">Check it out here</a>. Nothing has changed so if you want more SSR magic ‚ú® this still 100% applies.</p>
</blockquote>
<p>When you have a client-side React request, the general flow looks like this:</p>
<p><img src="/images/request1.png" alt="User requests app, user waits for HTML and JS bundle to be requested, once downloaded they can finally see the app"></p>
<p>Generally speaking, this is acceptable for many apps. A lot of apps you interact with on a daily basis work just fine like this. However, you may run into situations where it may behoove you to alter the performance profile of your app a bit.</p>
<p><img src="/images/request2.png" alt="User requests app, server pre-renders app, users sees complete HTML while the React app bootstraps itself"></p>
<p>Notice the time to interactive and time to first meaningful paint are different now. In the previous version they were the same moment, we have now separated them.</p>
<p>You may be looking at this thinking &quot;this is better!&quot; and in many cases it is: people see something quickly and before they can decide to take an action, generally the app will be bootstrapped. It will <em>feel</em> faster to the user despite the time to interactive will nearly always be tens of milliseconds later (as your app has to render on the server and that takes time). However be careful with this assumption as it in some cases it <em>isn&#39;t</em> faster.</p>
<ul>
<li>SSR carries with it complexity - some code can be executed in the browser and can&#39;t in Node.js (e.g. Google Analytics! it relies on browser APIs). You now need to cleanly separate what runs in browser and what doesn&#39;t.</li>
<li>On fast devices with fast connections, it will tend to actually be a bit slower to get both first paint and first interactive. If you&#39;re writing an app for iPhone 16 users in San Francisco, you really don&#39;t need SSR. If you&#39;re writing it for rural farmers in Montana or the Indian country-side, maybe SSR could help!</li>
<li>The key here is <em>measure</em>. SSR can be a great tool in your toolbox but make sure it&#39;s actually making a positive difference to your users.</li>
</ul>
<h2>SSR by hand</h2>
<p>Okay, so let&#39;s write a very simple SSR app.</p>
<p>In a new folder, run</p>
<pre><code class="hljs language-bash">npx init -y
npm i fastify @fastify/static react react-dom vite
</code></pre><p>Make sure your package.json has <code>&quot;type&quot;: &quot;module&quot;</code> in it. Add this to the scripts:</p>
<pre><code class="hljs language-json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vite build&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node ./server.js&quot;</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre><p>In the project root, create an index.html</p>
<pre><code class="hljs language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>SSR Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;module&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;./Client.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--ROOT--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><blockquote>
<p>üí° We&#39;re doing vanilla JS again, but it&#39;s easier now to add JSX if you want to. Vite has <code>--ssr</code> flag you can add to compile an app for use w/ React doing SSR. We&#39;re not covering it today but feel free to try later.</p>
</blockquote>
<p>Create an App.js, put in there:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { createElement <span class="hljs-keyword">as</span> h, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
    <span class="hljs-string">&quot;div&quot;</span>,
    <span class="hljs-literal">null</span>,
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;h1&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;Hello Frontend Masters&quot;</span>),
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;p&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;This is SSR&quot;</span>),
    <span class="hljs-title function_">h</span>(<span class="hljs-string">&quot;button&quot;</span>, { <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setCount</span>(count + <span class="hljs-number">1</span>) }, <span class="hljs-string">`Count: <span class="hljs-subst">${count}</span>`</span>)
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre><p>Now create a Client.js file</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { hydrateRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom/client&quot;</span>;
<span class="hljs-keyword">import</span> { createElement <span class="hljs-keyword">as</span> h } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.js&quot;</span>;

<span class="hljs-title function_">hydrateRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;root&quot;</span>), <span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>));
</code></pre><p>This is code that will <em>only</em> execute in the browser. If you have Google Analytics or local storage or anything like that, you&#39;d do those sorts of things that <em>need</em> to happen in the browser but don&#39;t need to be run in Node.js. Specifically, hydrateRoot will only run on the browser and can&#39;t run on the server.</p>
<p>Now for the spicy bit, let&#39;s do server-side rendering</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> fastify <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;fastify&quot;</span>;
<span class="hljs-keyword">import</span> fastifyStatic <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@fastify/static&quot;</span>;
<span class="hljs-keyword">import</span> { readFileSync } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:fs&quot;</span>;
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:url&quot;</span>;
<span class="hljs-keyword">import</span> path, { dirname } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;node:path&quot;</span>;
<span class="hljs-keyword">import</span> { renderToString } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-dom/server&quot;</span>;
<span class="hljs-keyword">import</span> { createElement <span class="hljs-keyword">as</span> h } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./App.js&quot;</span>;

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>);
<span class="hljs-keyword">const</span> __dirname = <span class="hljs-title function_">dirname</span>(__filename);

<span class="hljs-keyword">const</span> shell = <span class="hljs-title function_">readFileSync</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&quot;dist&quot;</span>, <span class="hljs-string">&quot;index.html&quot;</span>), <span class="hljs-string">&quot;utf8&quot;</span>);

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">fastify</span>();

app.<span class="hljs-title function_">register</span>(fastifyStatic, {
  <span class="hljs-attr">root</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&quot;dist&quot;</span>),
  <span class="hljs-attr">prefix</span>: <span class="hljs-string">&quot;/&quot;</span>,
});

<span class="hljs-keyword">const</span> parts = shell.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&lt;!--ROOT--&gt;&quot;</span>);
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> {
  reply.<span class="hljs-property">raw</span>.<span class="hljs-title function_">write</span>(parts[<span class="hljs-number">0</span>]);
  <span class="hljs-keyword">const</span> reactApp = <span class="hljs-title function_">renderToString</span>(<span class="hljs-title function_">h</span>(<span class="hljs-title class_">App</span>));
  reply.<span class="hljs-property">raw</span>.<span class="hljs-title function_">write</span>(reactApp);
  reply.<span class="hljs-property">raw</span>.<span class="hljs-title function_">write</span>(parts[<span class="hljs-number">1</span>]);
  reply.<span class="hljs-property">raw</span>.<span class="hljs-title function_">end</span>();
});

app.<span class="hljs-title function_">listen</span>({
  <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
});
</code></pre><blockquote>
<p>If you&#39;re getting hydration errors, you may have a whitespace problem (I did when writing this.) React is <em>super</em> sensitive to anything being different between client and server. I had to make sure that <code>&lt;div&gt;&lt;!--ROOT--&gt;&lt;/div&gt;</code> had no newlines in it.</p>
</blockquote>
<p>The interesting part is the &quot;/&quot; get handler. We immediately write the head to the user. This allows the browser to see the script tag and immediately start downloading the React app. We then render the app and send it to the user. This means by the time the app is rendered and sent to the user, it&#39;ll be pretty close to the time the user finishes downloading the script and should get a faster time to first meaningful pain and a decent time to interactive. We finish it off by sending the rest of the closing tags to the user.</p>
<blockquote>
<p>We did this with renderToString. You can do this with renderToPipeableStream as well and on a larger app see some improvement as it&#39;ll stream markup as it finishes to the user. I wanted to show you renderToString which works well for this micro app, but on a bigger codebase I&#39;d choose streaming. We&#39;re about to do use renderToPipeableStream for React Server Components so you&#39;re about to learn how to use it anyway.</p>
</blockquote>
</div><div class="lesson-links"><a href="/lessons/react-render-modes/static-site-generation" class="prev">‚Üê Previous</a><a href="/lessons/rscs-without-a-framework/intro-to-react-server-components" class="next">Next ‚Üí</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Discover how to enhance your React app's performance with server-side rendering (SSR) as demonstrated by Brian Holt in the Intermediate React v6 course for Frontend Masters. Learn how to implement SSR by hand to optimize time to interactive and first meaningful paint, along with considerations for complexity and device performance. Explore practical examples of SSR app setup with Fastify, Vite, and React, including handling browser-only scripts and overcoming hydration errors.","keywords":["React","server-side rendering","SSR","Brian Holt","Frontend Masters"]},"html":"\u003cblockquote\u003e\n\u003cp\u003eüí° The previous version of this course does a pretty in-depth dive on migrating a client-side React app to being server-side render. \u003ca href=\"https://frontendmasters.com/courses/intermediate-react-v5/server-side-rendering/\"\u003eCheck it out here\u003c/a\u003e. Nothing has changed so if you want more SSR magic ‚ú® this still 100% applies.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eWhen you have a client-side React request, the general flow looks like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/request1.png\" alt=\"User requests app, user waits for HTML and JS bundle to be requested, once downloaded they can finally see the app\"\u003e\u003c/p\u003e\n\u003cp\u003eGenerally speaking, this is acceptable for many apps. A lot of apps you interact with on a daily basis work just fine like this. However, you may run into situations where it may behoove you to alter the performance profile of your app a bit.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/request2.png\" alt=\"User requests app, server pre-renders app, users sees complete HTML while the React app bootstraps itself\"\u003e\u003c/p\u003e\n\u003cp\u003eNotice the time to interactive and time to first meaningful paint are different now. In the previous version they were the same moment, we have now separated them.\u003c/p\u003e\n\u003cp\u003eYou may be looking at this thinking \u0026quot;this is better!\u0026quot; and in many cases it is: people see something quickly and before they can decide to take an action, generally the app will be bootstrapped. It will \u003cem\u003efeel\u003c/em\u003e faster to the user despite the time to interactive will nearly always be tens of milliseconds later (as your app has to render on the server and that takes time). However be careful with this assumption as it in some cases it \u003cem\u003eisn\u0026#39;t\u003c/em\u003e faster.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSSR carries with it complexity - some code can be executed in the browser and can\u0026#39;t in Node.js (e.g. Google Analytics! it relies on browser APIs). You now need to cleanly separate what runs in browser and what doesn\u0026#39;t.\u003c/li\u003e\n\u003cli\u003eOn fast devices with fast connections, it will tend to actually be a bit slower to get both first paint and first interactive. If you\u0026#39;re writing an app for iPhone 16 users in San Francisco, you really don\u0026#39;t need SSR. If you\u0026#39;re writing it for rural farmers in Montana or the Indian country-side, maybe SSR could help!\u003c/li\u003e\n\u003cli\u003eThe key here is \u003cem\u003emeasure\u003c/em\u003e. SSR can be a great tool in your toolbox but make sure it\u0026#39;s actually making a positive difference to your users.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eSSR by hand\u003c/h2\u003e\n\u003cp\u003eOkay, so let\u0026#39;s write a very simple SSR app.\u003c/p\u003e\n\u003cp\u003eIn a new folder, run\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpx init -y\nnpm i fastify @fastify/static react react-dom vite\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eMake sure your package.json has \u003ccode\u003e\u0026quot;type\u0026quot;: \u0026quot;module\u0026quot;\u003c/code\u003e in it. Add this to the scripts:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-json\"\u003e\u003cspan class=\"hljs-attr\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;vite build\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;node ./server.js\u0026quot;\u003c/span\u003e\n\u003cspan class=\"hljs-punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e,\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIn the project root, create an index.html\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE \u003cspan class=\"hljs-keyword\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;en\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eSSR Example\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edefer\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;module\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;./Client.js\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;root\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!--ROOT--\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eüí° We\u0026#39;re doing vanilla JS again, but it\u0026#39;s easier now to add JSX if you want to. Vite has \u003ccode\u003e--ssr\u003c/code\u003e flag you can add to compile an app for use w/ React doing SSR. We\u0026#39;re not covering it today but feel free to try later.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eCreate an App.js, put in there:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createElement \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e h, useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eApp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [count, setCount] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;div\u0026quot;\u003c/span\u003e,\n    \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e,\n    \u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;h1\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;Hello Frontend Masters\u0026quot;\u003c/span\u003e),\n    \u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;p\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;This is SSR\u0026quot;\u003c/span\u003e),\n    \u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;button\u0026quot;\u003c/span\u003e, { \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e: \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetCount\u003c/span\u003e(count + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) }, \u003cspan class=\"hljs-string\"\u003e`Count: \u003cspan class=\"hljs-subst\"\u003e${count}\u003c/span\u003e`\u003c/span\u003e)\n  );\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow create a Client.js file\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { hydrateRoot } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react-dom/client\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createElement \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e h } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./App.js\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003ehydrateRoot\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetElementById\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;root\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis is code that will \u003cem\u003eonly\u003c/em\u003e execute in the browser. If you have Google Analytics or local storage or anything like that, you\u0026#39;d do those sorts of things that \u003cem\u003eneed\u003c/em\u003e to happen in the browser but don\u0026#39;t need to be run in Node.js. Specifically, hydrateRoot will only run on the browser and can\u0026#39;t run on the server.\u003c/p\u003e\n\u003cp\u003eNow for the spicy bit, let\u0026#39;s do server-side rendering\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fastify \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;fastify\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fastifyStatic \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;@fastify/static\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { readFileSync } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;node:fs\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { fileURLToPath } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;node:url\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e path, { dirname } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;node:path\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderToString } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react-dom/server\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { createElement \u003cspan class=\"hljs-keyword\"\u003eas\u003c/span\u003e h } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./App.js\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e __filename = \u003cspan class=\"hljs-title function_\"\u003efileURLToPath\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003emeta\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e __dirname = \u003cspan class=\"hljs-title function_\"\u003edirname\u003c/span\u003e(__filename);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e shell = \u003cspan class=\"hljs-title function_\"\u003ereadFileSync\u003c/span\u003e(path.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string\"\u003e\u0026quot;dist\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;index.html\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-string\"\u003e\u0026quot;utf8\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003efastify\u003c/span\u003e();\n\napp.\u003cspan class=\"hljs-title function_\"\u003eregister\u003c/span\u003e(fastifyStatic, {\n  \u003cspan class=\"hljs-attr\"\u003eroot\u003c/span\u003e: path.\u003cspan class=\"hljs-title function_\"\u003ejoin\u003c/span\u003e(__dirname, \u003cspan class=\"hljs-string\"\u003e\u0026quot;dist\u0026quot;\u003c/span\u003e),\n  \u003cspan class=\"hljs-attr\"\u003eprefix\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e,\n});\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e parts = shell.\u003cspan class=\"hljs-title function_\"\u003esplit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026lt;!--ROOT--\u0026gt;\u0026quot;\u003c/span\u003e);\napp.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ereq, reply\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  reply.\u003cspan class=\"hljs-property\"\u003eraw\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(parts[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e reactApp = \u003cspan class=\"hljs-title function_\"\u003erenderToString\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003eh\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eApp\u003c/span\u003e));\n  reply.\u003cspan class=\"hljs-property\"\u003eraw\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(reactApp);\n  reply.\u003cspan class=\"hljs-property\"\u003eraw\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ewrite\u003c/span\u003e(parts[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]);\n  reply.\u003cspan class=\"hljs-property\"\u003eraw\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eend\u003c/span\u003e();\n});\n\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e({\n  \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e,\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cblockquote\u003e\n\u003cp\u003eIf you\u0026#39;re getting hydration errors, you may have a whitespace problem (I did when writing this.) React is \u003cem\u003esuper\u003c/em\u003e sensitive to anything being different between client and server. I had to make sure that \u003ccode\u003e\u0026lt;div\u0026gt;\u0026lt;!--ROOT--\u0026gt;\u0026lt;/div\u0026gt;\u003c/code\u003e had no newlines in it.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eThe interesting part is the \u0026quot;/\u0026quot; get handler. We immediately write the head to the user. This allows the browser to see the script tag and immediately start downloading the React app. We then render the app and send it to the user. This means by the time the app is rendered and sent to the user, it\u0026#39;ll be pretty close to the time the user finishes downloading the script and should get a faster time to first meaningful pain and a decent time to interactive. We finish it off by sending the rest of the closing tags to the user.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWe did this with renderToString. You can do this with renderToPipeableStream as well and on a larger app see some improvement as it\u0026#39;ll stream markup as it finishes to the user. I wanted to show you renderToString which works well for this micro app, but on a bigger codebase I\u0026#39;d choose streaming. We\u0026#39;re about to do use renderToPipeableStream for React Server Components so you\u0026#39;re about to learn how to use it anyway.\u003c/p\u003e\n\u003c/blockquote\u003e\n","markdown":"\u003e üí° The previous version of this course does a pretty in-depth dive on migrating a client-side React app to being server-side render. [Check it out here][v5]. Nothing has changed so if you want more SSR magic ‚ú® this still 100% applies.\n\nWhen you have a client-side React request, the general flow looks like this:\n\n![User requests app, user waits for HTML and JS bundle to be requested, once downloaded they can finally see the app](/images/request1.png)\n\nGenerally speaking, this is acceptable for many apps. A lot of apps you interact with on a daily basis work just fine like this. However, you may run into situations where it may behoove you to alter the performance profile of your app a bit.\n\n![User requests app, server pre-renders app, users sees complete HTML while the React app bootstraps itself](/images/request2.png)\n\nNotice the time to interactive and time to first meaningful paint are different now. In the previous version they were the same moment, we have now separated them.\n\nYou may be looking at this thinking \"this is better!\" and in many cases it is: people see something quickly and before they can decide to take an action, generally the app will be bootstrapped. It will _feel_ faster to the user despite the time to interactive will nearly always be tens of milliseconds later (as your app has to render on the server and that takes time). However be careful with this assumption as it in some cases it _isn't_ faster.\n\n- SSR carries with it complexity - some code can be executed in the browser and can't in Node.js (e.g. Google Analytics! it relies on browser APIs). You now need to cleanly separate what runs in browser and what doesn't.\n- On fast devices with fast connections, it will tend to actually be a bit slower to get both first paint and first interactive. If you're writing an app for iPhone 16 users in San Francisco, you really don't need SSR. If you're writing it for rural farmers in Montana or the Indian country-side, maybe SSR could help!\n- The key here is _measure_. SSR can be a great tool in your toolbox but make sure it's actually making a positive difference to your users.\n\n## SSR by hand\n\nOkay, so let's write a very simple SSR app.\n\nIn a new folder, run\n\n```bash\nnpx init -y\nnpm i fastify @fastify/static react react-dom vite\n```\n\nMake sure your package.json has `\"type\": \"module\"` in it. Add this to the scripts:\n\n```json\n\"scripts\": {\n  \"build\": \"vite build\",\n  \"start\": \"node ./server.js\"\n},\n```\n\nIn the project root, create an index.html\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n  \u003chead\u003e\n    \u003ctitle\u003eSSR Example\u003c/title\u003e\n    \u003cscript async defer type=\"module\" src=\"./Client.js\"\u003e\u003c/script\u003e\n  \u003c/head\u003e\n  \u003cbody\u003e\n    \u003cdiv id=\"root\"\u003e\u003c!--ROOT--\u003e\u003c/div\u003e\n  \u003c/body\u003e\n\u003c/html\u003e\n```\n\n\u003e üí° We're doing vanilla JS again, but it's easier now to add JSX if you want to. Vite has `--ssr` flag you can add to compile an app for use w/ React doing SSR. We're not covering it today but feel free to try later.\n\nCreate an App.js, put in there:\n\n```javascript\nimport { createElement as h, useState } from \"react\";\n\nfunction App() {\n  const [count, setCount] = useState(0);\n  return h(\n    \"div\",\n    null,\n    h(\"h1\", null, \"Hello Frontend Masters\"),\n    h(\"p\", null, \"This is SSR\"),\n    h(\"button\", { onClick: () =\u003e setCount(count + 1) }, `Count: ${count}`)\n  );\n}\n\nexport default App;\n```\n\nNow create a Client.js file\n\n```javascript\nimport { hydrateRoot } from \"react-dom/client\";\nimport { createElement as h } from \"react\";\nimport App from \"./App.js\";\n\nhydrateRoot(document.getElementById(\"root\"), h(App));\n```\n\nThis is code that will _only_ execute in the browser. If you have Google Analytics or local storage or anything like that, you'd do those sorts of things that _need_ to happen in the browser but don't need to be run in Node.js. Specifically, hydrateRoot will only run on the browser and can't run on the server.\n\nNow for the spicy bit, let's do server-side rendering\n\n```javascript\nimport fastify from \"fastify\";\nimport fastifyStatic from \"@fastify/static\";\nimport { readFileSync } from \"node:fs\";\nimport { fileURLToPath } from \"node:url\";\nimport path, { dirname } from \"node:path\";\nimport { renderToString } from \"react-dom/server\";\nimport { createElement as h } from \"react\";\nimport App from \"./App.js\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nconst shell = readFileSync(path.join(__dirname, \"dist\", \"index.html\"), \"utf8\");\n\nconst app = fastify();\n\napp.register(fastifyStatic, {\n  root: path.join(__dirname, \"dist\"),\n  prefix: \"/\",\n});\n\nconst parts = shell.split(\"\u003c!--ROOT--\u003e\");\napp.get(\"/\", (req, reply) =\u003e {\n  reply.raw.write(parts[0]);\n  const reactApp = renderToString(h(App));\n  reply.raw.write(reactApp);\n  reply.raw.write(parts[1]);\n  reply.raw.end();\n});\n\napp.listen({\n  port: 3000,\n});\n```\n\n\u003e If you're getting hydration errors, you may have a whitespace problem (I did when writing this.) React is _super_ sensitive to anything being different between client and server. I had to make sure that `\u003cdiv\u003e\u003c!--ROOT--\u003e\u003c/div\u003e` had no newlines in it.\n\nThe interesting part is the \"/\" get handler. We immediately write the head to the user. This allows the browser to see the script tag and immediately start downloading the React app. We then render the app and send it to the user. This means by the time the app is rendered and sent to the user, it'll be pretty close to the time the user finishes downloading the script and should get a faster time to first meaningful pain and a decent time to interactive. We finish it off by sending the rest of the closing tags to the user.\n\n\u003e We did this with renderToString. You can do this with renderToPipeableStream as well and on a larger app see some improvement as it'll stream markup as it finishes to the user. I wanted to show you renderToString which works well for this micro app, but on a bigger codebase I'd choose streaming. We're about to do use renderToPipeableStream for React Server Components so you're about to learn how to use it anyway.\n\n[v5]: https://frontendmasters.com/courses/intermediate-react-v5/server-side-rendering/\n","slug":"server-side-rendering","title":"Server Side Rendering","section":"React Render Modes","icon":"paint-roller","filePath":"/home/runner/work/intermediate-react-v6/intermediate-react-v6/lessons/02-react-render-modes/C-server-side-rendering.md","nextSlug":"/lessons/rscs-without-a-framework/intro-to-react-server-components","prevSlug":"/lessons/react-render-modes/static-site-generation"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"react-render-modes","slug":"server-side-rendering"},"buildId":"81bftuYLGkwiC8AXLtnRs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>