<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Server Actions – Intermediate React v6</title><meta name="description" content="Learn how to create server actions in React using a backend function integration with forms, simplifying the process of managing form data in this lesson from Brian Holt&#x27;s Intermediate React v6 course from Frontend Masters. This tutorial covers the implementation of server components to automatically handle data transport from frontend to backend without manual &#x27;fetch&#x27; coding." data-next-head=""/><meta name="keywords" content="React,server actions,frontend,backend,form integration,Brian Holt,Frontend Masters" data-next-head=""/><meta name="og:description" content="Learn how to create server actions in React using a backend function integration with forms, simplifying the process of managing form data in this lesson from Brian Holt&#x27;s Intermediate React v6 course from Frontend Masters. This tutorial covers the implementation of server components to automatically handle data transport from frontend to backend without manual &#x27;fetch&#x27; coding." data-next-head=""/><meta name="og:title" content="Server Actions – Intermediate React v6" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/0732dfa8741dc542.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0732dfa8741dc542.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-a4ddb9b21624b39b.js" defer=""></script><script src="/_next/static/chunks/main-d4c20200ddabac7f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-31cd0638bbee6098.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-7da2347a1e0b6c73.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_buildManifest.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Intermediate React v6</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/courses/intermediate-react-v6/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>One of the most common interactions that users have with websites is some variation on submitting a form - whether that&#39;s a very traditional &quot;fill out this form and hit submit&quot; or something similar where the developer uses a form under the hood to handle inputs and then uses a submit event to fire off an API call.</p>
<p>The React team leaned into this with a feature called server actions. You can essentially create an RSC that has an action on the form that will cause an action to fire on the server. It makes it really simple to hook up a frontend form and a backend function to process it. Let&#39;s first craft our form.</p>
<p>Make a folder inside app called <code>write</code>. In there put page.js, so that we can have the route <code>/write</code>.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncDatabase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;promised-sqlite3&quot;</span>;
<span class="hljs-keyword">import</span> postNote <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./postNote&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Write</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUsers</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncDatabase</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;./notes.db&quot;</span>);
    <span class="hljs-keyword">return</span> db.<span class="hljs-title function_">all</span>(<span class="hljs-string">&quot;SELECT * FROM users&quot;</span>);
  }
  <span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUsers</span>();

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;note-fieldset&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">legend</span>&gt;</span>Write a new note<span class="hljs-tag">&lt;/<span class="hljs-name">legend</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">{postNote}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;note-form&quot;</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
            From
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;from_user&quot;</span>&gt;</span>
              {users.map((user) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{user.id}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{user.id}</span>&gt;</span>
                  {user.name}
                <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
            To
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">defaultValue</span>=<span class="hljs-string">{2}</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;to_user&quot;</span>&gt;</span>
              {users.map((user) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{user.id}</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{user.id}</span>&gt;</span>
                  {user.name}
                <span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              ))}
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
            Note
            <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;note&quot;</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>Save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre><p><code>&lt;form action={postNote} className=&quot;note-form&quot;&gt;</code> is the interesting part here. We&#39;re going to go code this up now but essentially it&#39;s allowing us to directly plug a backend function into the frontend form and React will take care of the transport of the data from frontend to backend. We get to skip writing all the <code>fetch</code> logic - React does it for us. We could have totally written this in the no-framework version of our app but it would have just been some extra steps in the server code. This is a React feature that Next.js implements.</p>
<p>Let&#39;s go write postNote.js in the same directory.</p>
<pre><code class="hljs language-javascript"><span class="hljs-string">&quot;use server&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncDatabase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;promised-sqlite3&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">postNote</span>(<span class="hljs-params">formData</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;postNote called&quot;</span>, formData);

  <span class="hljs-keyword">const</span> <span class="hljs-keyword">from</span> = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;from_user&quot;</span>);
  <span class="hljs-keyword">const</span> to = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;to_user&quot;</span>);
  <span class="hljs-keyword">const</span> note = formData.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;note&quot;</span>);

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">from</span> || !to || !note) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;All fields are required&quot;</span>);
  }

  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncDatabase</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;./notes.db&quot;</span>);
  <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">run</span>(
    <span class="hljs-string">&quot;INSERT INTO notes (from_user, to_user, note) VALUES (?, ?, ?)&quot;</span>,
    [<span class="hljs-keyword">from</span>, to, note]
  );
}
</code></pre><p><em>Now</em> we need the <code>&quot;use server&quot;;</code> directive at the top as this must be run on the server and we need to disambiguate that for React. Try commenting it out - the app will crash.</p>
<p>Pretty cool, right? I love not having to write the whole API handshake code and just to have it written for me.</p>
<p>Be sure to watch the network tab as well - it&#39;s cool to see the React Flight protocol handle it!</p>
</div><div class="lesson-links"><a href="/lessons/rscs-with-nextjs/server-components" class="prev">← Previous</a><a href="/lessons/rscs-with-nextjs/server-and-client-components-together" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to create server actions in React using a backend function integration with forms, simplifying the process of managing form data in this lesson from Brian Holt's Intermediate React v6 course from Frontend Masters. This tutorial covers the implementation of server components to automatically handle data transport from frontend to backend without manual 'fetch' coding.","keywords":["React","server actions","frontend","backend","form integration","Brian Holt","Frontend Masters"]},"html":"\u003cp\u003eOne of the most common interactions that users have with websites is some variation on submitting a form - whether that\u0026#39;s a very traditional \u0026quot;fill out this form and hit submit\u0026quot; or something similar where the developer uses a form under the hood to handle inputs and then uses a submit event to fire off an API call.\u003c/p\u003e\n\u003cp\u003eThe React team leaned into this with a feature called server actions. You can essentially create an RSC that has an action on the form that will cause an action to fire on the server. It makes it really simple to hook up a frontend form and a backend function to process it. Let\u0026#39;s first craft our form.\u003c/p\u003e\n\u003cp\u003eMake a folder inside app called \u003ccode\u003ewrite\u003c/code\u003e. In there put page.js, so that we can have the route \u003ccode\u003e/write\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;promised-sqlite3\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e postNote \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./postNote\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eWrite\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetUsers\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./notes.db\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e db.\u003cspan class=\"hljs-title function_\"\u003eall\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT * FROM users\u0026quot;\u003c/span\u003e);\n  }\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e users = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetUsers\u003c/span\u003e();\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003efieldset\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;note-fieldset\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elegend\u003c/span\u003e\u0026gt;\u003c/span\u003eWrite a new note\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elegend\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eaction\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{postNote}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclassName\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;note-form\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            From\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eselect\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;from_user\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              {users.map((user) =\u0026gt; (\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{user.id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{user.id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  {user.name}\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              ))}\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eselect\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            To\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eselect\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003edefaultValue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{2}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;to_user\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              {users.map((user) =\u0026gt; (\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{user.id}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003evalue\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{user.id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                  {user.name}\n                \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eoption\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              ))}\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eselect\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            Note\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etextarea\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;note\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003elabel\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;submit\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eSave\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eform\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003efieldset\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003ccode\u003e\u0026lt;form action={postNote} className=\u0026quot;note-form\u0026quot;\u0026gt;\u003c/code\u003e is the interesting part here. We\u0026#39;re going to go code this up now but essentially it\u0026#39;s allowing us to directly plug a backend function into the frontend form and React will take care of the transport of the data from frontend to backend. We get to skip writing all the \u003ccode\u003efetch\u003c/code\u003e logic - React does it for us. We could have totally written this in the no-framework version of our app but it would have just been some extra steps in the server code. This is a React feature that Next.js implements.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s go write postNote.js in the same directory.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;use server\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;promised-sqlite3\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003epostNote\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eformData\u003c/span\u003e) {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;postNote called\u0026quot;\u003c/span\u003e, formData);\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e = formData.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;from_user\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e to = formData.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;to_user\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e note = formData.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;note\u0026quot;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e || !to || !note) {\n    \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;All fields are required\u0026quot;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./notes.db\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db.\u003cspan class=\"hljs-title function_\"\u003erun\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;INSERT INTO notes (from_user, to_user, note) VALUES (?, ?, ?)\u0026quot;\u003c/span\u003e,\n    [\u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e, to, note]\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cem\u003eNow\u003c/em\u003e we need the \u003ccode\u003e\u0026quot;use server\u0026quot;;\u003c/code\u003e directive at the top as this must be run on the server and we need to disambiguate that for React. Try commenting it out - the app will crash.\u003c/p\u003e\n\u003cp\u003ePretty cool, right? I love not having to write the whole API handshake code and just to have it written for me.\u003c/p\u003e\n\u003cp\u003eBe sure to watch the network tab as well - it\u0026#39;s cool to see the React Flight protocol handle it!\u003c/p\u003e\n","markdown":"One of the most common interactions that users have with websites is some variation on submitting a form - whether that's a very traditional \"fill out this form and hit submit\" or something similar where the developer uses a form under the hood to handle inputs and then uses a submit event to fire off an API call.\n\nThe React team leaned into this with a feature called server actions. You can essentially create an RSC that has an action on the form that will cause an action to fire on the server. It makes it really simple to hook up a frontend form and a backend function to process it. Let's first craft our form.\n\nMake a folder inside app called `write`. In there put page.js, so that we can have the route `/write`.\n\n```javascript\nimport { AsyncDatabase } from \"promised-sqlite3\";\nimport postNote from \"./postNote\";\n\nexport default async function Write() {\n  async function getUsers() {\n    const db = await AsyncDatabase.open(\"./notes.db\");\n    return db.all(\"SELECT * FROM users\");\n  }\n  const users = await getUsers();\n\n  return (\n    \u003cdiv\u003e\n      \u003cfieldset className=\"note-fieldset\"\u003e\n        \u003clegend\u003eWrite a new note\u003c/legend\u003e\n        \u003cform action={postNote} className=\"note-form\"\u003e\n          \u003clabel\u003e\n            From\n            \u003cselect name=\"from_user\"\u003e\n              {users.map((user) =\u003e (\n                \u003coption key={user.id} value={user.id}\u003e\n                  {user.name}\n                \u003c/option\u003e\n              ))}\n            \u003c/select\u003e\n          \u003c/label\u003e\n          \u003clabel\u003e\n            To\n            \u003cselect defaultValue={2} name=\"to_user\"\u003e\n              {users.map((user) =\u003e (\n                \u003coption key={user.id} value={user.id}\u003e\n                  {user.name}\n                \u003c/option\u003e\n              ))}\n            \u003c/select\u003e\n          \u003c/label\u003e\n          \u003clabel\u003e\n            Note\n            \u003ctextarea name=\"note\" /\u003e\n          \u003c/label\u003e\n          \u003cbutton type=\"submit\"\u003eSave\u003c/button\u003e\n        \u003c/form\u003e\n      \u003c/fieldset\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n`\u003cform action={postNote} className=\"note-form\"\u003e` is the interesting part here. We're going to go code this up now but essentially it's allowing us to directly plug a backend function into the frontend form and React will take care of the transport of the data from frontend to backend. We get to skip writing all the `fetch` logic - React does it for us. We could have totally written this in the no-framework version of our app but it would have just been some extra steps in the server code. This is a React feature that Next.js implements.\n\nLet's go write postNote.js in the same directory.\n\n```javascript\n\"use server\";\nimport { AsyncDatabase } from \"promised-sqlite3\";\n\nexport default async function postNote(formData) {\n  console.log(\"postNote called\", formData);\n\n  const from = formData.get(\"from_user\");\n  const to = formData.get(\"to_user\");\n  const note = formData.get(\"note\");\n\n  if (!from || !to || !note) {\n    throw new Error(\"All fields are required\");\n  }\n\n  const db = await AsyncDatabase.open(\"./notes.db\");\n  await db.run(\n    \"INSERT INTO notes (from_user, to_user, note) VALUES (?, ?, ?)\",\n    [from, to, note]\n  );\n}\n```\n\n_Now_ we need the `\"use server\";` directive at the top as this must be run on the server and we need to disambiguate that for React. Try commenting it out - the app will crash.\n\nPretty cool, right? I love not having to write the whole API handshake code and just to have it written for me.\n\nBe sure to watch the network tab as well - it's cool to see the React Flight protocol handle it!\n","slug":"server-actions","title":"Server Actions","section":"RSCs with Next.js","icon":"n","filePath":"/home/runner/work/intermediate-react-v6/intermediate-react-v6/lessons/04-rscs-with-nextjs/C-server-actions.md","nextSlug":"/lessons/rscs-with-nextjs/server-and-client-components-together","prevSlug":"/lessons/rscs-with-nextjs/server-components"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"rscs-with-nextjs","slug":"server-actions"},"buildId":"81bftuYLGkwiC8AXLtnRs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>