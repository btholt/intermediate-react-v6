<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" data-next-head=""/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png" data-next-head=""/><link rel="icon" type="image/x-icon" href="/images/favicon.ico" data-next-head=""/><title data-next-head="">Server and Client Components Together – Intermediate React v6</title><meta name="description" content="Learn how to effectively combine server and client components in React by implementing a polling system for real-time data updates, as explained by Brian Holt in Intermediate React v6 for Frontend Masters." data-next-head=""/><meta name="keywords" content="React components,client-server,polling,real-time updates,Frontend Masters,Brian Holt" data-next-head=""/><meta name="og:description" content="Learn how to effectively combine server and client components in React by implementing a polling system for real-time data updates, as explained by Brian Holt in Intermediate React v6 for Frontend Masters." data-next-head=""/><meta name="og:title" content="Server and Client Components Together – Intermediate React v6" data-next-head=""/><meta name="og:image" content="/images/social-share-cover.jpg" data-next-head=""/><meta name="twitter:card" content="summary_large_image" data-next-head=""/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/0732dfa8741dc542.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0732dfa8741dc542.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" noModule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-b66ed8ba6f029a99.js" defer=""></script><script src="/_next/static/chunks/framework-a4ddb9b21624b39b.js" defer=""></script><script src="/_next/static/chunks/main-d4c20200ddabac7f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-31cd0638bbee6098.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-7da2347a1e0b6c73.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_buildManifest.js" defer=""></script><script src="/_next/static/81bftuYLGkwiC8AXLtnRs/_ssgManifest.js" defer=""></script></head><body><script async="" defer="" src="https://a.holt.courses/latest.js"></script><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Intermediate React v6</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/courses/intermediate-react-v6/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>One question you should probably have by this point is &quot;how do I mix server and client component?&quot; Super valid - we&#39;re obviously going to need both in order to ship complete apps. So how do we do that? Just by being a little judicious of how nest things and using React&#39;s innate ability to nest components.</p>
<p>Let&#39;s say we have a secret teacher view that allows the teacher to see all the notes passed between everyone in their class. And we want that data to be consistently updated so a teacher can always see the latest notes. How would we do that? Let&#39;s do it with polling - we&#39;ll query the database for rows in the database and then we&#39;ll continually update it.</p>
<p>Now, we could just make it totally a client component but we&#39;re going to make it load with complete data for the first time and then we&#39;ll start polling.</p>
<p>So how do we do that? We&#39;ll have a server component loading the first page load&#39;s data, and then we&#39;ll have a child client component doing the polling and re-rendering. Best of both worlds!</p>
<p>Make a folder called <code>teacher</code> in the app directory and put a page.js file in there with this in it:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">TeacherClientPage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./clientPage&quot;</span>;
<span class="hljs-keyword">import</span> fetchNotes <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./fetchNotes&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TeacherView</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> initialNotes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchNotes</span>();
  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">TeacherClientPage</span> <span class="hljs-attr">initialNotes</span>=<span class="hljs-string">{initialNotes}</span> <span class="hljs-attr">fetchNotes</span>=<span class="hljs-string">{fetchNotes}</span> /&gt;</span></span>
  );
}
</code></pre><p>This a server component that will load initial notes from a fetchNotes function and then feed it in as a prop. Let&#39;s go write that fetchNotes.js file.</p>
<pre><code class="hljs language-javascript"><span class="hljs-string">&quot;use server&quot;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncDatabase</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;promised-sqlite3&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchNotes</span>(<span class="hljs-params">since</span>) {
  <span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncDatabase</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;./notes.db&quot;</span>);
  <span class="hljs-keyword">let</span> rows;
  <span class="hljs-keyword">if</span> (since) {
    rows = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">all</span>(
      <span class="hljs-string">&quot;SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user WHERE n.id &gt; ? LIMIT 50&quot;</span>,
      [since]
    );
  } <span class="hljs-keyword">else</span> {
    rows = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">all</span>(
      <span class="hljs-string">&quot;SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user LIMIT 50&quot;</span>
    );
  }
  <span class="hljs-keyword">return</span> rows;
}
</code></pre><p>Another server function to fetch our latest update of rows. It&#39;ll only grab whatever is newer than what the client had. What&#39;s nice is we can share this function between the initial payload and the update function in the client. Let&#39;s go make clientPage.js then.</p>
<pre><code class="hljs language-javascript"><span class="hljs-string">&quot;use client&quot;</span>;
<span class="hljs-keyword">import</span> { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TeacherClientPage</span>(<span class="hljs-params">{ fetchNotes, initialNotes }</span>) {
  <span class="hljs-keyword">const</span> [notes, setNotes] = <span class="hljs-title function_">useState</span>(initialNotes ? initialNotes : []);

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-title function_">async</span> () =&gt; {
      <span class="hljs-keyword">let</span> since;
      <span class="hljs-keyword">if</span> (notes.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        since = notes[notes.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]?.<span class="hljs-property">id</span> ?? <span class="hljs-literal">null</span>;
      }
      <span class="hljs-keyword">const</span> newNotes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchNotes</span>(since);
      <span class="hljs-title function_">setNotes</span>([...notes, ...newNotes]);
    }, <span class="hljs-number">5000</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">clearInterval</span>(interval);
  }, []);

  <span class="hljs-keyword">return</span> (
    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Teacher&#x27;s View<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {notes.map((note) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{note.id}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">fieldset</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>
                from: {note.from_user} | to: {note.to_user}
              <span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{note.note}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">fieldset</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre><p>Now we have a client component that is using a server function to poll for changes, and its initial payload is seeded by a server component. Pretty cool, right? Best of both worlds.</p>
</div><div class="lesson-links"><a href="/lessons/rscs-with-nextjs/server-actions" class="prev">← Previous</a><a href="/lessons/rscs-with-nextjs/limitations-of-rscs" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg fill="none" height="auto" width="32" xmlns="http://www.w3.org/2000/svg" viewBox="0.254 0.25 500 451.95400000000006"><path d="M394.033.25h76.67L303.202 191.693l197.052 260.511h-154.29L225.118 294.205 86.844 452.204H10.127l179.16-204.77L.254.25H158.46l109.234 144.417zm-26.908 406.063h42.483L135.377 43.73h-45.59z" fill="var(--footer-icons)"></path></svg></a></li><li class="social"><a href="https://bsky.app/profile/brianholt.me"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3.268 64 68.414" width="38" height="auto"><path fill="var(--footer-icons)" d="M13.873 3.805C21.21 9.332 29.103 20.537 32 26.55v15.882c0-.338-.13.044-.41.867-1.512 4.456-7.418 21.847-20.923 7.944-7.111-7.32-3.819-14.64 9.125-16.85-7.405 1.264-15.73-.825-18.014-9.015C1.12 23.022 0 8.51 0 6.55 0-3.268 8.579-.182 13.873 3.805zm36.254 0C42.79 9.332 34.897 20.537 32 26.55v15.882c0-.338.13.044.41.867 1.512 4.456 7.418 21.847 20.923 7.944 7.111-7.32 3.819-14.64-9.125-16.85 7.405 1.264 15.73-.825 18.014-9.015C62.88 23.022 64 8.51 64 6.55c0-9.818-8.578-6.732-13.873-2.745z"></path></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Exercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"description":"Learn how to effectively combine server and client components in React by implementing a polling system for real-time data updates, as explained by Brian Holt in Intermediate React v6 for Frontend Masters.","keywords":["React components","client-server","polling","real-time updates","Frontend Masters","Brian Holt"]},"html":"\u003cp\u003eOne question you should probably have by this point is \u0026quot;how do I mix server and client component?\u0026quot; Super valid - we\u0026#39;re obviously going to need both in order to ship complete apps. So how do we do that? Just by being a little judicious of how nest things and using React\u0026#39;s innate ability to nest components.\u003c/p\u003e\n\u003cp\u003eLet\u0026#39;s say we have a secret teacher view that allows the teacher to see all the notes passed between everyone in their class. And we want that data to be consistently updated so a teacher can always see the latest notes. How would we do that? Let\u0026#39;s do it with polling - we\u0026#39;ll query the database for rows in the database and then we\u0026#39;ll continually update it.\u003c/p\u003e\n\u003cp\u003eNow, we could just make it totally a client component but we\u0026#39;re going to make it load with complete data for the first time and then we\u0026#39;ll start polling.\u003c/p\u003e\n\u003cp\u003eSo how do we do that? We\u0026#39;ll have a server component loading the first page load\u0026#39;s data, and then we\u0026#39;ll have a child client component doing the polling and re-rendering. Best of both worlds!\u003c/p\u003e\n\u003cp\u003eMake a folder called \u003ccode\u003eteacher\u003c/code\u003e in the app directory and put a page.js file in there with this in it:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTeacherClientPage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./clientPage\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fetchNotes \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;./fetchNotes\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eTeacherView\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e initialNotes = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchNotes\u003c/span\u003e();\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eTeacherClientPage\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003einitialNotes\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{initialNotes}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efetchNotes\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{fetchNotes}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis a server component that will load initial notes from a fetchNotes function and then feed it in as a prop. Let\u0026#39;s go write that fetchNotes.js file.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;use server\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;promised-sqlite3\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchNotes\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esince\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eAsyncDatabase\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./notes.db\u0026quot;\u003c/span\u003e);\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e rows;\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (since) {\n    rows = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db.\u003cspan class=\"hljs-title function_\"\u003eall\u003c/span\u003e(\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user WHERE n.id \u0026gt; ? LIMIT 50\u0026quot;\u003c/span\u003e,\n      [since]\n    );\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n    rows = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e db.\u003cspan class=\"hljs-title function_\"\u003eall\u003c/span\u003e(\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user LIMIT 50\u0026quot;\u003c/span\u003e\n    );\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e rows;\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnother server function to fetch our latest update of rows. It\u0026#39;ll only grab whatever is newer than what the client had. What\u0026#39;s nice is we can share this function between the initial payload and the update function in the client. Let\u0026#39;s go make clientPage.js then.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-string\"\u003e\u0026quot;use client\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useState, useEffect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eTeacherClientPage\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e{ fetchNotes, initialNotes }\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [notes, setNotes] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(initialNotes ? initialNotes : []);\n\n  \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e interval = \u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e () =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e since;\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (notes.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e \u0026gt; \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n        since = notes[notes.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e - \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e]?.\u003cspan class=\"hljs-property\"\u003eid\u003c/span\u003e ?? \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n      }\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newNotes = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetchNotes\u003c/span\u003e(since);\n      \u003cspan class=\"hljs-title function_\"\u003esetNotes\u003c/span\u003e([...notes, ...newNotes]);\n    }, \u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eclearInterval\u003c/span\u003e(interval);\n  }, []);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003eTeacher\u0026#x27;s View\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh1\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        {notes.map((note) =\u0026gt; (\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ekey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{note.id}\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003efieldset\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003e\n                from: {note.from_user} | to: {note.to_user}\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eh2\u003c/span\u003e\u0026gt;\u003c/span\u003e\n              \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e{note.note}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ep\u003c/span\u003e\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003efieldset\u003c/span\u003e\u0026gt;\u003c/span\u003e\n          \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eli\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        ))}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eul\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eNow we have a client component that is using a server function to poll for changes, and its initial payload is seeded by a server component. Pretty cool, right? Best of both worlds.\u003c/p\u003e\n","markdown":"\nOne question you should probably have by this point is \"how do I mix server and client component?\" Super valid - we're obviously going to need both in order to ship complete apps. So how do we do that? Just by being a little judicious of how nest things and using React's innate ability to nest components.\n\nLet's say we have a secret teacher view that allows the teacher to see all the notes passed between everyone in their class. And we want that data to be consistently updated so a teacher can always see the latest notes. How would we do that? Let's do it with polling - we'll query the database for rows in the database and then we'll continually update it.\n\nNow, we could just make it totally a client component but we're going to make it load with complete data for the first time and then we'll start polling.\n\nSo how do we do that? We'll have a server component loading the first page load's data, and then we'll have a child client component doing the polling and re-rendering. Best of both worlds!\n\nMake a folder called `teacher` in the app directory and put a page.js file in there with this in it:\n\n```javascript\nimport TeacherClientPage from \"./clientPage\";\nimport fetchNotes from \"./fetchNotes\";\n\nexport default async function TeacherView() {\n  const initialNotes = await fetchNotes();\n  return (\n    \u003cTeacherClientPage initialNotes={initialNotes} fetchNotes={fetchNotes} /\u003e\n  );\n}\n```\n\nThis a server component that will load initial notes from a fetchNotes function and then feed it in as a prop. Let's go write that fetchNotes.js file.\n\n```javascript\n\"use server\";\nimport { AsyncDatabase } from \"promised-sqlite3\";\n\nexport default async function fetchNotes(since) {\n  const db = await AsyncDatabase.open(\"./notes.db\");\n  let rows;\n  if (since) {\n    rows = await db.all(\n      \"SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user WHERE n.id \u003e ? LIMIT 50\",\n      [since]\n    );\n  } else {\n    rows = await db.all(\n      \"SELECT n.id as id, n.note as note, f.name as from_user, t.name as to_user FROM notes n JOIN users f ON f.id = n.from_user JOIN users t ON t.id = n.to_user LIMIT 50\"\n    );\n  }\n  return rows;\n}\n```\n\nAnother server function to fetch our latest update of rows. It'll only grab whatever is newer than what the client had. What's nice is we can share this function between the initial payload and the update function in the client. Let's go make clientPage.js then.\n\n```javascript\n\"use client\";\nimport { useState, useEffect } from \"react\";\n\nexport default function TeacherClientPage({ fetchNotes, initialNotes }) {\n  const [notes, setNotes] = useState(initialNotes ? initialNotes : []);\n\n  useEffect(() =\u003e {\n    const interval = setInterval(async () =\u003e {\n      let since;\n      if (notes.length \u003e 0) {\n        since = notes[notes.length - 1]?.id ?? null;\n      }\n      const newNotes = await fetchNotes(since);\n      setNotes([...notes, ...newNotes]);\n    }, 5000);\n    return () =\u003e clearInterval(interval);\n  }, []);\n\n  return (\n    \u003cdiv\u003e\n      \u003ch1\u003eTeacher's View\u003c/h1\u003e\n      \u003cul\u003e\n        {notes.map((note) =\u003e (\n          \u003cli key={note.id}\u003e\n            \u003cfieldset\u003e\n              \u003ch2\u003e\n                from: {note.from_user} | to: {note.to_user}\n              \u003c/h2\u003e\n              \u003cp\u003e{note.note}\u003c/p\u003e\n            \u003c/fieldset\u003e\n          \u003c/li\u003e\n        ))}\n      \u003c/ul\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nNow we have a client component that is using a server function to poll for changes, and its initial payload is seeded by a server component. Pretty cool, right? Best of both worlds.\n","slug":"server-and-client-components-together","title":"Server and Client Components Together","section":"RSCs with Next.js","icon":"n","filePath":"/home/runner/work/intermediate-react-v6/intermediate-react-v6/lessons/04-rscs-with-nextjs/D-server-and-client-components-together.md","nextSlug":"/lessons/rscs-with-nextjs/limitations-of-rscs","prevSlug":"/lessons/rscs-with-nextjs/server-actions"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"rscs-with-nextjs","slug":"server-and-client-components-together"},"buildId":"81bftuYLGkwiC8AXLtnRs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>