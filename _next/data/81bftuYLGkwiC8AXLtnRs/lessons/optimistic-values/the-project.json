{"pageProps":{"post":{"attributes":{"description":"Discover how to build a UI in React using server and client interactions including POST requests with intentional delays for error simulation, as outlined in Brian Holt's Intermediate React v6 course on Frontend Masters. Learn to handle UI feedback during asynchronous operations efficiently with techniques like useOptimisticState, enhancing your web development skills with JavaScript and server components.","keywords":["React","server components","UI development","Brian Holt","Frontend Masters","JavaScript","web development"]},"html":"<blockquote>\n<p>You will need to open the folder <code>optimistic</code> from the repo in your project.</p>\n<ul>\n<li><a href=\"https://github.com/btholt/irv6-project/tree/main/starter/optimistic\">The starter template</a></li>\n<li><a href=\"https://github.com/btholt/irv6-project/tree/main/completed/optimistic\">The completed project</a></li>\n</ul>\n</blockquote>\n<p>Let&#39;s open the project.</p>\n<ol>\n<li>Open optimistic folder in your editor of choice</li>\n<li>Run <code>npm install</code></li>\n<li>Glance at server.js - it responds to GET and POST on /thoughts</li>\n<li>Run <code>npm run dev:server</code> to run the server</li>\n<li>Run <code>npm run dev:client</code> in another terminal window to run the Vite server</li>\n</ol>\n<p>You&#39;ll notice two things here in the server.js file, the DELAY and the ERROR_RATE. I intentionally slowed down the POST request so you can see how the loading state works. Feel free to change how long the delay is (it&#39;s in milliseconds). I also wanted you to see what errors look like, so it fails 20% of the time, this is also configurable.</p>\n<p>Okay, let&#39;s build a UI that shows users deep thoughts, and allow them to post their own. In App.jsx, put</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { useEffect, useState } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">App</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> [thoughts, setThoughts] = <span class=\"hljs-title function_\">useState</span>([]);\n  <span class=\"hljs-keyword\">const</span> [thought, setThought] = <span class=\"hljs-title function_\">useState</span>(<span class=\"hljs-string\">&quot;&quot;</span>);\n\n  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">postDeepThought</span>(<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-title function_\">setThought</span>(<span class=\"hljs-string\">&quot;&quot;</span>);\n    <span class=\"hljs-keyword\">const</span> response = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&quot;/thoughts&quot;</span>, {\n      <span class=\"hljs-attr\">method</span>: <span class=\"hljs-string\">&quot;POST&quot;</span>,\n      <span class=\"hljs-attr\">headers</span>: {\n        <span class=\"hljs-string\">&quot;Content-Type&quot;</span>: <span class=\"hljs-string\">&quot;application/json&quot;</span>,\n      },\n      <span class=\"hljs-attr\">body</span>: <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>({ thought }),\n    });\n    <span class=\"hljs-keyword\">if</span> (!response.<span class=\"hljs-property\">ok</span>) {\n      <span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;This thought was not deep enough. Please try again.&quot;</span>);\n      <span class=\"hljs-keyword\">return</span>;\n    }\n    <span class=\"hljs-keyword\">const</span> { <span class=\"hljs-attr\">thoughts</span>: newThoughts } = <span class=\"hljs-keyword\">await</span> response.<span class=\"hljs-title function_\">json</span>();\n    <span class=\"hljs-title function_\">setThoughts</span>(newThoughts);\n  }\n\n  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&quot;/thoughts&quot;</span>)\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> res.<span class=\"hljs-title function_\">json</span>())\n      .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">data</span>) =&gt;</span> {\n        <span class=\"hljs-title function_\">setThoughts</span>(data);\n      });\n  }, []);\n\n  <span class=\"hljs-keyword\">return</span> (\n    <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">className</span>=<span class=\"hljs-string\">&quot;app&quot;</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">h1</span>&gt;</span>Deep Thoughts<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">h1</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span>\n        <span class=\"hljs-attr\">onSubmit</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> {\n          e.preventDefault();\n          postDeepThought();\n        }}\n      &gt;\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">label</span> <span class=\"hljs-attr\">htmlFor</span>=<span class=\"hljs-string\">&quot;thought&quot;</span>&gt;</span>What&#x27;s on your mind?<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">label</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">textarea</span>\n          <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;thought&quot;</span>\n          <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;thought&quot;</span>\n          <span class=\"hljs-attr\">rows</span>=<span class=\"hljs-string\">&quot;5&quot;</span>\n          <span class=\"hljs-attr\">cols</span>=<span class=\"hljs-string\">&quot;33&quot;</span>\n          <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{thought}</span>\n          <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setThought(e.target.value)}\n        /&gt;\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">&quot;submit&quot;</span>&gt;</span>Submit<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">ul</span>&gt;</span>\n        {thoughts.map((thought, index) =&gt; (\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">li</span> <span class=\"hljs-attr\">key</span>=<span class=\"hljs-string\">{thought}</span>&gt;</span>{thought}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">li</span>&gt;</span>\n        ))}\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">ul</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>\n  );\n}\n</code></pre><ul>\n<li>Nothing surprising here. We get thoughts on load, and we reload them on POST</li>\n<li>The big issue here is that the user is shown no feedback while the POST happening.</li>\n<li>We could just append to thoughts and hope for the best - and this is what we used to do.</li>\n<li>However we can use <code>useOptimistic</code> and get a lot of the error cases and other problems wrapped up and taken care of for us.</li>\n</ul>\n","markdown":"\n> You will need to open the folder `optimistic` from the repo in your project.\n>\n> - [The starter template][starter]\n> - [The completed project][completed]\n\nLet's open the project.\n\n1. Open optimistic folder in your editor of choice\n1. Run `npm install`\n1. Glance at server.js - it responds to GET and POST on /thoughts\n1. Run `npm run dev:server` to run the server\n1. Run `npm run dev:client` in another terminal window to run the Vite server\n\nYou'll notice two things here in the server.js file, the DELAY and the ERROR_RATE. I intentionally slowed down the POST request so you can see how the loading state works. Feel free to change how long the delay is (it's in milliseconds). I also wanted you to see what errors look like, so it fails 20% of the time, this is also configurable.\n\nOkay, let's build a UI that shows users deep thoughts, and allow them to post their own. In App.jsx, put\n\n```javascript\nimport { useEffect, useState } from \"react\";\n\nexport default function App() {\n  const [thoughts, setThoughts] = useState([]);\n  const [thought, setThought] = useState(\"\");\n\n  async function postDeepThought() {\n    setThought(\"\");\n    const response = await fetch(\"/thoughts\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({ thought }),\n    });\n    if (!response.ok) {\n      alert(\"This thought was not deep enough. Please try again.\");\n      return;\n    }\n    const { thoughts: newThoughts } = await response.json();\n    setThoughts(newThoughts);\n  }\n\n  useEffect(() => {\n    fetch(\"/thoughts\")\n      .then((res) => res.json())\n      .then((data) => {\n        setThoughts(data);\n      });\n  }, []);\n\n  return (\n    <div className=\"app\">\n      <h1>Deep Thoughts</h1>\n      <form\n        onSubmit={(e) => {\n          e.preventDefault();\n          postDeepThought();\n        }}\n      >\n        <label htmlFor=\"thought\">What's on your mind?</label>\n        <textarea\n          id=\"thought\"\n          name=\"thought\"\n          rows=\"5\"\n          cols=\"33\"\n          value={thought}\n          onChange={(e) => setThought(e.target.value)}\n        />\n        <button type=\"submit\">Submit</button>\n      </form>\n      <ul>\n        {thoughts.map((thought, index) => (\n          <li key={thought}>{thought}</li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n```\n\n- Nothing surprising here. We get thoughts on load, and we reload them on POST\n- The big issue here is that the user is shown no feedback while the POST happening.\n- We could just append to thoughts and hope for the best - and this is what we used to do.\n- However we can use `useOptimistic` and get a lot of the error cases and other problems wrapped up and taken care of for us.\n\n[starter]: https://github.com/btholt/irv6-project/tree/main/starter/optimistic\n[completed]: https://github.com/btholt/irv6-project/tree/main/completed/optimistic\n","slug":"the-project","title":"The Project","section":"Optimistic Values","icon":"sun","filePath":"/home/runner/work/intermediate-react-v6/intermediate-react-v6/lessons/07-optimistic-values/B-the-project.md","nextSlug":"/lessons/optimistic-values/useOptimistic-Hook","prevSlug":"/lessons/optimistic-values/what-are-optimistic-values"}},"__N_SSG":true}