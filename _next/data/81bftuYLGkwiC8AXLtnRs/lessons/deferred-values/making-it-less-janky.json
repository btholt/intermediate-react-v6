{"pageProps":{"post":{"attributes":{"description":"Learn how to optimize React performance using 'useDeferredValue' to manage low priority rendering, a tool that dynamically adapts to user's device speed, in Brian Holt's \"Intermediate React v6\" course by Frontend Masters.","keywords":["React","useDeferredValue","performance optimization","deferred rendering","Brian Holt"]},"html":"<p>So how can we make things less janky?</p>\n<p>In the past we have to use something like <a href=\"https://css-tricks.com/debouncing-throttling-explained-examples/\">throttle or debounce</a> - we&#39;d limit how frequently we&#39;d allow the functions to update. This works but it&#39;s a blunt instrument - it&#39;s complicated code (I have to look up debounce vs throttle every time) and it doesn&#39;t scale with the user&#39;s device. Slow and fast devices alike will get slowed down.</p>\n<p>Enter <code>useDeferredValue</code>. It uses React&#39;s low priority rendering to say &quot;hey, if you&#39;re still busy doing high priority stuff, feel free to delay changing this low priority stuff&quot; to React. What&#39;s cool about that is this <em>will</em> scale with the user&#39;s device. A fast device will chew through updates quickly and get to the low priority updates quickly while a slower device will be given space to sort through high priority updates and wait for the lower ones.</p>\n<p>Let&#39;s make it happen.</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-comment\">// replace filterStyles</span>\n<span class=\"hljs-keyword\">const</span> deferredBlur = <span class=\"hljs-title function_\">useDeferredValue</span>(blur);\n<span class=\"hljs-keyword\">const</span> deferredBrightness = <span class=\"hljs-title function_\">useDeferredValue</span>(brightness);\n<span class=\"hljs-keyword\">const</span> deferredContrast = <span class=\"hljs-title function_\">useDeferredValue</span>(contrast);\n<span class=\"hljs-keyword\">const</span> deferredSaturate = <span class=\"hljs-title function_\">useDeferredValue</span>(saturate);\n<span class=\"hljs-keyword\">const</span> deferredSepia = <span class=\"hljs-title function_\">useDeferredValue</span>(sepia);\n\n<span class=\"hljs-keyword\">const</span> filterStyle = <span class=\"hljs-string\">`\n  blur(<span class=\"hljs-subst\">${deferredBlur}</span>px)\n  brightness(<span class=\"hljs-subst\">${deferredBrightness}</span>%)\n  contrast(<span class=\"hljs-subst\">${deferredContrast}</span>%)\n  saturate(<span class=\"hljs-subst\">${deferredSaturate}</span>%)\n  sepia(<span class=\"hljs-subst\">${deferredSepia}</span>%)`</span>;\n\n\n<span class=\"hljs-comment\">// change deferred</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Slider</span>\n  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{blur}</span>\n  <span class=\"hljs-attr\">deferred</span>=<span class=\"hljs-string\">{deferredBlur}</span>\n  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setBlur(e.target.value)}\n  name=&quot;Blur&quot;\n/&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Slider</span>\n  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{brightness}</span>\n  <span class=\"hljs-attr\">deferred</span>=<span class=\"hljs-string\">{deferredBrightness}</span>\n  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setBrightness(e.target.value)}\n  name=&quot;Brightness&quot;\n/&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Slider</span>\n  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{contrast}</span>\n  <span class=\"hljs-attr\">deferred</span>=<span class=\"hljs-string\">{deferredContrast}</span>\n  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setContrast(e.target.value)}\n  name=&quot;Contrast&quot;\n/&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Slider</span>\n  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{saturate}</span>\n  <span class=\"hljs-attr\">deferred</span>=<span class=\"hljs-string\">{deferredSaturate}</span>\n  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setSaturate(e.target.value)}\n  name=&quot;Saturate&quot;\n/&gt;</span>\n<span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Slider</span>\n  <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">{sepia}</span>\n  <span class=\"hljs-attr\">deferred</span>=<span class=\"hljs-string\">{deferredSepia}</span>\n  <span class=\"hljs-attr\">onChange</span>=<span class=\"hljs-string\">{(e)</span> =&gt;</span> setSepia(e.target.value)}\n  name=&quot;Sepia&quot;\n/&gt;</span>\n</code></pre><ul>\n<li>We still have jank - that&#39;s expected, we have a 200ms delay chucked into our code. But it&#39;s working <em>much</em> better than it was.</li>\n<li>There&#39;s probably a clever way to just useDeferredValue with just the filterStyle or other things - notice it&#39;s deferred <strong>value</strong> and not deferred <strong>state</strong> - you can use it with any value.</li>\n</ul>\n<p>Let&#39;s take it one step further. As long as a deferred value hasn&#39;t changed, that means the filterStyle string hasn&#39;t changed. Using <code>memo</code> like we learned before allows us to prevent the notorious jank-inducer <code>expensiveRender</code> from running. Let&#39;s go do that.</p>\n<p>In DisplayImage</p>\n<pre><code class=\"hljs language-javascript\"><span class=\"hljs-keyword\">import</span> { memo } <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">&quot;react&quot;</span>;\n\n<span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">default</span> <span class=\"hljs-title function_\">memo</span>(<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">DisplayImage</span>(<span class=\"hljs-params\">{ filterStyle }</span>) {\n  <span class=\"hljs-comment\">// other code here</span>\n});\n</code></pre><ul>\n<li>So much less jank</li>\n<li>Now watch that <code>Last render</code> value - notice it doesn&#39;t change until the deferred value catches up</li>\n</ul>\n<p>That&#39;s it! Using our new tools we can even work around heavy computation by using a little help from the React scheduler!</p>\n","markdown":"So how can we make things less janky?\n\nIn the past we have to use something like [throttle or debounce][throttle] - we'd limit how frequently we'd allow the functions to update. This works but it's a blunt instrument - it's complicated code (I have to look up debounce vs throttle every time) and it doesn't scale with the user's device. Slow and fast devices alike will get slowed down.\n\nEnter `useDeferredValue`. It uses React's low priority rendering to say \"hey, if you're still busy doing high priority stuff, feel free to delay changing this low priority stuff\" to React. What's cool about that is this _will_ scale with the user's device. A fast device will chew through updates quickly and get to the low priority updates quickly while a slower device will be given space to sort through high priority updates and wait for the lower ones.\n\nLet's make it happen.\n\n```javascript\n// replace filterStyles\nconst deferredBlur = useDeferredValue(blur);\nconst deferredBrightness = useDeferredValue(brightness);\nconst deferredContrast = useDeferredValue(contrast);\nconst deferredSaturate = useDeferredValue(saturate);\nconst deferredSepia = useDeferredValue(sepia);\n\nconst filterStyle = `\n  blur(${deferredBlur}px)\n  brightness(${deferredBrightness}%)\n  contrast(${deferredContrast}%)\n  saturate(${deferredSaturate}%)\n  sepia(${deferredSepia}%)`;\n\n\n// change deferred\n<Slider\n  value={blur}\n  deferred={deferredBlur}\n  onChange={(e) => setBlur(e.target.value)}\n  name=\"Blur\"\n/>\n<Slider\n  value={brightness}\n  deferred={deferredBrightness}\n  onChange={(e) => setBrightness(e.target.value)}\n  name=\"Brightness\"\n/>\n<Slider\n  value={contrast}\n  deferred={deferredContrast}\n  onChange={(e) => setContrast(e.target.value)}\n  name=\"Contrast\"\n/>\n<Slider\n  value={saturate}\n  deferred={deferredSaturate}\n  onChange={(e) => setSaturate(e.target.value)}\n  name=\"Saturate\"\n/>\n<Slider\n  value={sepia}\n  deferred={deferredSepia}\n  onChange={(e) => setSepia(e.target.value)}\n  name=\"Sepia\"\n/>\n```\n\n- We still have jank - that's expected, we have a 200ms delay chucked into our code. But it's working _much_ better than it was.\n- There's probably a clever way to just useDeferredValue with just the filterStyle or other things - notice it's deferred **value** and not deferred **state** - you can use it with any value.\n\nLet's take it one step further. As long as a deferred value hasn't changed, that means the filterStyle string hasn't changed. Using `memo` like we learned before allows us to prevent the notorious jank-inducer `expensiveRender` from running. Let's go do that.\n\nIn DisplayImage\n\n```javascript\nimport { memo } from \"react\";\n\nexport default memo(function DisplayImage({ filterStyle }) {\n  // other code here\n});\n```\n\n- So much less jank\n- Now watch that `Last render` value - notice it doesn't change until the deferred value catches up\n\nThat's it! Using our new tools we can even work around heavy computation by using a little help from the React scheduler!\n\n[throttle]: https://css-tricks.com/debouncing-throttling-explained-examples/\n","slug":"making-it-less-janky","title":"Making It Less Janky","section":"Deferred Values","icon":"clock","filePath":"/home/runner/work/intermediate-react-v6/intermediate-react-v6/lessons/08-deferred-values/C-making-it-less-janky.md","nextSlug":"/lessons/wrap-up/congrats","prevSlug":"/lessons/deferred-values/the-project"}},"__N_SSG":true}